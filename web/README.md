# AI JSON Generator - Web Interface

## 功能概述

这是 AI JSON Generator 工具的 Web 前端界面，提供了一个用户友好的图形界面来远程调用 AI JSON 生成器功能。

### 主要功能

1. **在线模板编辑**: 支持 Jinja2 模板语法，可在线编辑和解析模板变量
2. **变量填入**: 支持单变量模式和批量 CSV 模式
3. **实时日志**: 通过 WebSocket 实时显示生成过程的日志
4. **结果管理**: 在线查看生成结果，支持文件预览和打包下载
5. **会话管理**: 自动会话管理，支持会话文件清理

## 界面布局

### 左侧面板 - 配置和输入
- **模板选择**: 选择预置模板或手动输入
- **变量设置**: 解析模板变量并填入值
- **批量模式**: 支持 CSV 批量生成
- **生成选项**: 配置 ONNX 转换等选项

### 右侧面板 - 输出和日志
- **状态显示**: 实时显示当前任务状态
- **实时日志**: 显示详细的生成过程日志
- **结果列表**: 查看和下载生成的文件

## 使用流程

### 1. 选择或输入模板
- 从下拉列表选择预置模板，或直接输入 Jinja2 模板内容
- 点击"解析变量"按钮自动识别模板中的变量

### 2. 配置变量
**单变量模式**:
- 在解析出的变量输入框中填入对应的值

**批量模式**:
- 切换到批量模式
- 选择预置 CSV 文件或上传自定义 CSV
- CSV 表头将作为模板变量使用

### 3. 生成测试用例
- 选择是否转换为 ONNX 模型
- 点击"生成测试用例"按钮开始生成
- 实时查看生成过程日志

### 4. 查看和下载结果
- 在右侧面板查看生成的文件列表
- 点击预览按钮查看 JSON 文件内容
- 点击"打包下载"下载所有结果文件

## 技术特性

### 前端技术
- **Bootstrap 5**: 响应式 UI 框架
- **Font Awesome**: 图标库
- **Socket.IO**: 实时通信
- **原生 JavaScript**: 无额外前端框架依赖

### 后端技术
- **Flask**: Web 框架
- **Flask-SocketIO**: WebSocket 支持
- **Jinja2**: 模板引擎
- **多线程**: 后台任务处理

### 核心功能
- **实时日志**: WebSocket 实时推送生成日志
- **会话管理**: 每个浏览器会话独立的文件存储
- **文件管理**: 自动文件清理和打包下载
- **错误处理**: 完善的错误提示和处理机制

## 安装和运行

### 1. 安装依赖
```bash
cd web
pip install -r requirements.txt
```

### 2. 启动服务器
```bash
# 方式1: 直接运行
python app.py

# 方式2: 使用启动脚本（推荐）
cd ..
python run_web.py
```

### 3. 访问界面
打开浏览器访问: http://localhost:5000

## 目录结构

```
web/
├── app.py                 # Flask 应用主文件
├── requirements.txt       # Python 依赖
├── static/               # 静态资源
│   ├── css/
│   │   └── style.css     # 自定义样式
│   ├── js/
│   │   └── app.js        # 前端 JavaScript
│   ├── uploads/          # 上传文件目录
│   └── downloads/        # 下载文件目录
├── templates/            # HTML 模板
│   └── index.html        # 主页模板
└── web_resources/        # Web 资源
    ├── templates/        # 预置模板文件
    └── csv_files/        # 预置 CSV 文件
```

## API 接口

### REST API
- `GET /api/templates` - 获取模板列表
- `GET /api/csv_files` - 获取 CSV 文件列表
- `POST /api/parse_template` - 解析模板变量
- `POST /api/generate` - 生成测试用例
- `GET /api/results/<session_id>` - 获取生成结果
- `GET /api/download/<session_id>` - 下载结果文件
- `POST /api/cleanup/<session_id>` - 清理会话文件

### WebSocket 事件
- `connect` - 客户端连接
- `log_message` - 实时日志消息
- `generation_complete` - 生成完成通知

## 安全特性

- 会话隔离: 每个浏览器会话独立的文件存储空间
- 文件大小限制: 限制上传文件大小防止滥用
- 路径安全: 使用安全的文件路径处理
- 自动清理: 会话结束后自动清理临时文件

## 故障排除

### 常见问题

1. **无法启动服务器**
   - 检查是否安装了所有依赖
   - 确认 5000 端口未被占用

2. **模板解析失败**
   - 检查 Jinja2 语法是否正确
   - 确认变量名称符合规范

3. **生成失败**
   - 检查 config.json 配置是否正确
   - 确认 API 密钥有效
   - 查看实时日志了解详细错误信息

4. **无法下载文件**
   - 确认生成任务已完成
   - 检查浏览器下载设置

### 日志调试
- 查看浏览器控制台获取前端错误信息
- 查看服务器终端获取后端日志
- 使用实时日志功能监控生成过程

## 开发说明

### 扩展功能
- 可在 `web_resources` 目录添加更多模板和 CSV 示例
- 可修改 `static/css/style.css` 自定义界面样式
- 可扩展 `app.py` 添加更多 API 接口

### 部署建议
- 生产环境建议使用 Gunicorn 或 uWSGI
- 配置反向代理（如 Nginx）
- 设置适当的文件权限和安全策略
