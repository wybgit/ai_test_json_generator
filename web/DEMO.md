# AI JSON Generator Web Interface - 功能演示

## 快速开始

### 1. 启动Web服务器

```bash
# 在项目根目录下运行
python run_web.py
```

服务器将在 `http://localhost:5000` 启动

### 2. 访问Web界面

打开浏览器访问 http://localhost:5000，你将看到一个现代化的Web界面：

- **左侧面板**: 配置和输入区域
- **右侧面板**: 输出和日志区域

## 功能演示步骤

### 步骤1: 加载预置模板

1. 在左侧面板的"模板选择"区域
2. 从下拉菜单选择 `op_template.prompt.txt` 或 `demo_template.prompt.txt`
3. 点击"加载模板"按钮
4. 模板内容将自动填入到文本框中

### 步骤2: 解析模板变量

1. 确保模板内容已加载
2. 点击"解析变量"按钮
3. 系统将自动识别 Jinja2 模板中的变量（如 `算子级联信息`、`算子级联结构` 等）
4. 在"变量设置"区域将显示对应的输入框

### 步骤3: 填入变量值

**方式一: 单变量模式**
1. 在解析出的变量输入框中填入值，例如：
   - `算子级联信息`: `Conv+BatchNorm+Relu`
   - `算子级联结构`: `串联`
   - `算子名`: `Conv`

**方式二: 批量模式**
1. 点击"批量模式"按钮切换
2. 选择预置的 CSV 文件（如 `test_points.csv`）
3. 点击"加载 CSV"
4. 点击"显示数据"预览 CSV 内容

### 步骤4: 配置生成选项

1. 可选择是否勾选"转换为 ONNX 模型"
2. 此选项将在生成 JSON 后自动转换为 ONNX 格式

### 步骤5: 生成测试用例

1. 点击"生成测试用例"按钮
2. 右侧日志区域将实时显示生成过程：
   - LLM 配置信息
   - 模板渲染过程
   - API 调用状态
   - JSON 验证结果
   - ONNX 转换状态（如果启用）

### 步骤6: 查看生成结果

1. 生成完成后，右侧将显示"生成结果"区域
2. 可以看到生成的文件列表：
   - `.json` 文件: 生成的 JSON 描述
   - `.onnx` 文件: ONNX 模型（如果启用转换）
   - `.csv` 文件: 批量处理结果记录
   - `.txt` 文件: 渲染后的提示文本

### 步骤7: 预览和下载

1. 点击文件旁边的"眼睛"图标预览 JSON 内容
2. 点击"打包下载"按钮下载所有生成的文件
3. 文件将打包为 ZIP 格式自动下载

## 高级功能演示

### 实时日志功能

- 所有生成过程都会在右侧实时显示
- 支持不同级别的日志（信息、成功、警告、错误）
- 日志带有时间戳，便于跟踪问题

### 批量CSV处理

1. 准备包含多行数据的 CSV 文件
2. CSV 表头将作为模板变量名
3. 每行数据将生成一个独立的测试用例
4. 支持断点续执行，网络中断后可继续

### 会话管理

- 每个浏览器标签页有独立的会话
- 生成的文件按会话隔离存储
- 页面关闭后可配置自动清理文件

### 错误处理

- 完善的错误提示和处理机制
- 模板语法错误自动检测
- LLM API 调用失败自动重试
- JSON 格式验证和修复

## 示例模板

### 基础算子模板 (demo_template.prompt.txt)

```jinja2
你是一个onnx模型NPU转换工具用例设计助手，设计{{ 算子名 }}算子的相关模型IR JSON内容。

请按照以下要求生成用例：
{{ 算子级联信息 }}

按照如下图结构进行算子级联：
{{ 算子级联结构 }}

{% if 特殊要求 %}
特殊要求：{{ 特殊要求 }}
{% endif %}

请生成一个完整的ONNX模型JSON描述...
```

### 复杂算子模板 (op_template.prompt.txt)

包含详细的 IR JSON 格式要求和算子连接规则，适合生成复杂的算子级联测试用例。

## 故障排除

### 常见问题

1. **生成失败**: 检查 API 配置和网络连接
2. **模板解析错误**: 确认 Jinja2 语法正确
3. **WebSocket 连接失败**: 刷新页面重新连接
4. **文件下载失败**: 确认生成任务已完成

### 调试技巧

1. 查看实时日志了解详细错误信息
2. 使用浏览器开发者工具检查网络请求
3. 检查后端终端输出的服务器日志
4. 尝试简单的单变量模式排除问题

## 性能优化

- 批量模式下建议单次处理不超过 100 个测试用例
- 大型模板建议分段处理以提高成功率
- 网络不稳定时增加重试次数
- 定期清理会话文件释放存储空间

## 扩展功能

### 自定义模板

1. 在 `web_resources/templates/` 目录添加新的 `.txt` 文件
2. 使用 Jinja2 语法编写模板
3. 重启服务器后即可在下拉菜单中选择

### 自定义CSV数据

1. 在 `web_resources/csv_files/` 目录添加新的 `.csv` 文件
2. 确保表头名称与模板变量匹配
3. 支持中文表头和变量名

### API集成

Web应用提供完整的 REST API，可与其他系统集成：

```bash
# 获取模板列表
curl http://localhost:5000/api/templates

# 解析模板变量
curl -X POST http://localhost:5000/api/parse_template \
  -H "Content-Type: application/json" \
  -d '{"template_content": "Hello {{ name }}"}'

# 生成测试用例
curl -X POST http://localhost:5000/api/generate \
  -H "Content-Type: application/json" \
  -d '{"template_content": "...", "variables": {...}}'
```

这个Web界面大大简化了 AI JSON Generator 的使用，让非技术用户也能轻松生成高质量的 ONNX 算子测试用例。
